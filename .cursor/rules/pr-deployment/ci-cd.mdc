---
description: "GitHub Actions workflows and CI/CD pipeline patterns"
globs:
  - ".github/workflows/**"
alwaysApply: false
---

# CI/CD Pipeline

GitHub Actions workflows and CI/CD patterns.

## GitHub Actions Workflows

**Lint Workflow** (`.github/workflows/lint.yml`):
- Runs on: push to main, pull requests to main
- Steps:
  1. Checkout code
  2. Setup Bun (latest version)
  3. Install dependencies (`bun install --frozen-lockfile`)
  4. Lint TypeScript (`bun run lint:ts`)
  5. Lint CSS (`bun run lint:css`)

**Deploy Workflow** (`.github/workflows/deploy.yml`):
- Runs on: push to main branch only
- Steps:
  1. Trigger webhook to VPS
  2. Validates webhook signature (HMAC SHA-256)
  3. Sends deployment request to VPS webhook endpoint

## Workflow Patterns

```yaml
# ✅ Lint workflow pattern
name: Lint
on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: oven-sh/setup-bun@v2
        with:
          bun-version: latest
      - run: bun install --frozen-lockfile
      - run: bun run lint:ts
      - run: bun run lint:css
```

```yaml
# ✅ Deploy workflow pattern
name: Deploy to VPS
on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger webhook
        env:
          WEBHOOK_URL: ${{ secrets.WEBHOOK_URL }}
          WEBHOOK_SECRET: ${{ secrets.WEBHOOK_SECRET }}
        run: |
          PAYLOAD='{"ref":"refs/heads/main"}'
          SIGNATURE=$(echo -n "$PAYLOAD" | openssl dgst -sha256 -hmac "$WEBHOOK_SECRET" -binary | xxd -p -c 256)
          curl -X POST "$WEBHOOK_URL" \
            -H "Content-Type: application/json" \
            -H "X-GitHub-Event: push" \
            -H "X-Hub-Signature-256: sha256=$SIGNATURE" \
            -d "$PAYLOAD"
```

## GitHub Secrets

Required secrets:
- `WEBHOOK_URL`: Full URL to webhook endpoint (e.g., `https://garage44.org/webhook`)
- `WEBHOOK_SECRET`: Shared secret for webhook validation

## Anti-patterns

❌ **Don't:**
- Run deployments on every push (only on main)
- Skip lint checks in CI
- Hardcode secrets in workflows
- Deploy without testing

✅ **Do:**
- Run lint on all PRs
- Deploy only on main branch
- Use GitHub secrets for sensitive data
- Test before deploying
