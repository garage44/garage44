---
description: "CRITICAL: Linting requirements and workflow - MUST READ before making any code changes"
globs:
  - "**/*.{ts,tsx,js,jsx,css}"
alwaysApply: true
priority: 1
---

# ‚ö†Ô∏è CRITICAL: Linting Requirements

**THIS IS THE MOST IMPORTANT RULE - READ THIS FIRST**

All code changes MUST pass linting checks before being committed. This rule applies to ALL files in the workspace.

## üö® MANDATORY Workflow

### Before Making ANY Code Changes

1. **Understand the linting rules**: Read `eslint.config.js` at the workspace root
2. **Check current lint status**: Run `bun run lint:ts` and `bun run lint:css` if modifying CSS
3. **Fix existing errors first**: Don't add new code on top of broken code

### After Making Code Changes

**YOU MUST RUN THESE COMMANDS BEFORE CONSIDERING THE TASK COMPLETE:**

```bash
# For TypeScript/TSX files
bun run lint:ts

# For CSS files (if you modified any CSS)
bun run lint:css
```

### Before Committing

**NEVER commit code without running lint checks first.**

The git hook (lefthook) will catch linting errors, but **agents should fix errors proactively**, not rely on the hook to fail.

## üîß Auto-Fixing Linting Errors

Many linting errors can be auto-fixed. The git hook (`lint-staged`) automatically fixes errors on commit, but you should fix them proactively:

**Option 1: Use lint-staged (recommended for staged files)**
```bash
# This runs automatically on commit, but you can run it manually:
bunx lint-staged
```

**Option 2: Run linters directly in package directories**
```bash
# Navigate to the package directory first, then:
cd packages/expressio  # or packages/pyrite, packages/malkovich, etc.

# Auto-fix TypeScript/TSX files
eslint **/*.{ts,tsx} --config ../../eslint.config.js --fix

# Auto-fix CSS files  
stylelint src/**/*.css --fix
```

**Option 3: Use bun run lint:ts/lint:css to check, then fix manually**
```bash
# Check for errors
bun run lint:ts
bun run lint:css

# Then fix errors manually based on the output
```

**After auto-fixing:**
1. Always verify the fixes don't break functionality
2. Run `bun run lint:ts` and `bun run lint:css` again to ensure all errors are resolved
3. Manually fix any remaining errors according to ESLint/Stylelint output

## üìã Key Linting Rules (Summary)

### TypeScript/TSX Files

- **Indentation**: 4 spaces (not tabs)
- **Quotes**: Single quotes (`'`) for strings
- **Semicolons**: Never use semicolons
- **Trailing commas**: Always use trailing commas in multiline structures
- **Line length**: Maximum 130 characters
- **JSX**: Self-closing tags, PascalCase components, single quotes for attributes
- **Spacing**: No spaces inside object/array brackets, spaces around operators
- **Sorting**: Objects, interfaces, and object types should be sorted alphabetically

### CSS Files

- **Indentation**: 4 spaces
- **Modern nesting**: Use CSS nesting, NOT BEM naming convention
- **No double underscores** (`__`) or **double dashes** (`--`) for modifiers
- **Component root**: Use `.c-{component-name}` convention

## üéØ Common Linting Errors to Avoid

### TypeScript/TSX

‚ùå **Wrong:**
```tsx
const obj = { a: 1, b: 2 };
const arr = [ 1, 2, 3 ];
function foo() { return "bar"; }
<div className="test" />
```

‚úÖ **Correct:**
```tsx
const obj = {a: 1, b: 2}
const arr = [1, 2, 3]
function foo() {
    return 'bar'
}
<div class="test" />
```

### CSS

‚ùå **Wrong:**
```css
.c-button__icon { }  /* BEM naming */
.c-button--disabled { }  /* BEM modifier */
```

‚úÖ **Correct:**
```css
.c-button {
    .icon { }  /* Use nesting */
    
    &.disabled { }  /* Use nesting for modifiers */
}
```

## üîç How to Read ESLint Errors

ESLint errors follow this format:
```
/path/to/file.ts:42:5: error message (@stylistic/rule-name)
```

- **Line 42, column 5**: The exact location of the error
- **error message**: What's wrong
- **@stylistic/rule-name**: The rule that was violated

Fix errors by:
1. Reading the error message
2. Understanding what the rule expects
3. Making the change
4. Running lint again to verify

## ‚ö° Quick Reference Commands

```bash
# Check all TypeScript files across all packages
bun run lint:ts

# Check all CSS files across all packages
bun run lint:css

# Auto-fix staged files (runs automatically on commit via lint-staged)
bunx lint-staged

# Auto-fix in a specific package (navigate to package directory first)
cd packages/expressio
eslint **/*.{ts,tsx} --config ../../eslint.config.js --fix
stylelint src/**/*.css --fix
```

## üö´ What NOT to Do

- ‚ùå Skip linting checks "because the git hook will catch it"
- ‚ùå Commit code with linting errors
- ‚ùå Ignore linting errors in favor of "getting it done"
- ‚ùå Assume auto-fix will solve everything
- ‚ùå Make changes without understanding the linting rules

## ‚úÖ What TO Do

- ‚úÖ Run lint checks after EVERY code change
- ‚úÖ Fix linting errors immediately
- ‚úÖ Verify auto-fixes don't break functionality
- ‚úÖ Read and understand ESLint error messages
- ‚úÖ Consult `eslint.config.js` for rule details
- ‚úÖ Test your changes after fixing lint errors

## üìö Additional Resources

- **ESLint config**: `/workspace/eslint.config.js`
- **Stylelint config**: Check individual package `package.json` files
- **Git hooks**: `/workspace/lefthook.yml` (runs lint-staged on commit)

## üéì Remember

**Linting is not optional. It's a requirement.**

Code that doesn't pass linting checks is considered incomplete and should not be committed. The git hook is a safety net, not a replacement for proactive linting.
